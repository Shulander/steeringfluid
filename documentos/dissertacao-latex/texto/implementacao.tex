\chapter{Implementação} 
\label{capitulo:implementacao}

\section{Definição de forças}
\subsection{Gravidade}
Para simulação de grupo de elementos em um sistema de {\it steering behaviors} a força gravitacional no mundo usualmente não é relevante para o resultado esperado, porém em uma representação gráfica de fluidos a gravidade é necessária e sua contribuição para a representação de fluidos importante para para a obtenção do fluxo e representação dos elementos corretamente.
A gravidade foi implementada como uma força que age constantemente sobre todos os elementos do sistema. Essa força faz com que os elementos formem um fluxo na direção de atuação da força. A figura \ref{fig:motion_behaviors_hierarchy} representa a implementação da gravidade no sistema.
\begin{figure}
\centering
\resizebox{10cm}{!}{\includegraphics{figuras/implementacao_gravity.png}}
\caption{Implementação: gravidade}
\label{fig:implementacao_gravity}
\end{figure}

A gravidade é aplicada a cada atualização do elemento, a qual é aplicada como um simples vetor força em direção ao eixo Y negativo.

\subsection{Coesão}
A coesão consiste em uma região, geralmente mais externa, na qual os elementos tendem a se aproximar do centro do grupo.
A coesão entre as partículas faz com que as mesmas tendam a não se separar do grupo de vizinhança. Esse agrupamento é esperado entre os elementos que compõem a simulação, pois o arrasto ou movimentação de um grupo de partículas faz com que as partículas em sua volta se desloquem em forma de torrente causado pelo arrasto dos elementos em movimento.
Em nossa implementação estudamos a força de coesão nas seguintes condições:
\begin{itemize}
\item Comportamento original: os elementos se atraem com igual força não importando em qual região de vizinhança o elemento se encontra, nesse caso em especial o comportamento de agrupamento dos elementos funcionava conforme esperado, porém com a força de separação (verificar a implementação da separação ~\ref{sec:impl_separacao}) adicionando força de forma exponencial ao inverso da distância entre os elementos o sistema tende a não se estabilizar.
\item Força exponencial: os elementos são atraídos através de uma força exponencial proporcional à distância entre os elementos do grupo, assim quanto mais afastado do centro e mais próximo da fronteira da região de vizinhança maior será a força de atração entre os elementos, e quanto mais próximo da região de separação menor a força fazendo com que os elementos encontrem uma região de transição estável entre a força de separação e coesão. Esse comportamento atuará como um facilitador na solução do problema de estabilização das forças internas do sistema ver seção ~\ref{sec:impl_reg_entropia}.
\end{itemize}

Além das modificações comportamental dos {\it steering behaviors} citadas, foram realizadas modificações na região de atuação da força e coesão e no seu peso na contribuição final na força resultante do processo de interação com os demais elementos. Com essas modificações espera-se chegar a representação da viscosidade de um fluido. Esse resultado é esperado pelo fato de que a região de coesão é determina a resistência em que os elementos são capaz de separar do grupo principal, quanto menor o for a colaboração na força final de interação mais fácil é da partícula se separar do grupo a qual ele pertence e quanto maior a sua contribuição, mais coeso é o grupo.

\subsection{Separação}
\label{sec:impl_separacao}
A força de separação tende a afastar os elementos quando internos à região de separação.
A força de separação é um elemento importante na simulação de fluidos, a mesma vem em substituição da transferência de energia pela colisão dos elementos na simulação física de partículas. Como no steering behaviors os elementos não trabalham com colisão é necessária uma força capaz de separar os elementos quando muito próximos ou quando em rota de colisão. Essa força é diretamente proporcional ao inverso da distância ao quadrado fazendo com que a mesma cresça rapidamente ao se aproximar de outro elemento, resultando na separação de ambos os elementos.
A região de atuação da força de separação corresponde com a distância esperada em que as partículas permaneçam separadas uma das outras, analogamente podemos relacionar com a densidade do fluido, pois quanto mais próximas as partículas se estabilizarem mais difícil sera desloca-las na interação com outros elementos, dado que a força de repulsão do grupo a um elemento novo é maior devido ao somatório das forças resultantes do grupo. 

\subsection{Alinhamento}
A força de alinhamento direciona os elementos a se alinharem com o grupo que pertence a região de alinhamento. Para os primeiros testes a mesma não esta sendo utilizada, pois para o comportamento das partículas o alinhamento das mesmas não representa uma contribuição importante para o sistema.

%\subsection{Região de atuação da vizinhança}
%\label{sec:impl_reg_vizinhanca}
%Na implementação dos steering behaviors cada elemento possui um campo de visão baseado no angulo definido de sua frente, essa região define qual a área em que é considerada na interação entre outros elementos. Os elementos fora dessa área ou raio não são relevantes para determinar as forças que estão atuando atualmente no elemento sendo descartados no processamento e restringindo a interação a um grupo de proximidade.
%A restrição da atuação é utilizada nos casos em que os elementos devem manter-se em movimentacao. TODO:  CONTINUAR COM A IDEIA.


\subsection{Interação com paredes do recipiente}
Existem duas abordagens que tratam a interação dos elementos com as paredes do recipiente, abordagem por forças ou uma restrição de movimentação dos elementos. 

Na abordagem por forças o sistema se torna mais genérico, facilitando a interação com os elementos do cenário pois basta determinar uma força restritiva nas paredes do recipiente para que o liquido permaneça em seu interior, essa abordagem possui problemas como a não garantia de que os elementos não atravessarão os limites determinados pois para isso necessitam somente de uma força maior que a força de restrição. 

Em contra partida existe a limitação por restrição de movimentação, isso é, não permitindo que os elementos saiam do espaço definido como recipiente, essa proposta possui a vantagem de que nenhum elemento sairá pelas paredes do recipiente, porém haverá a necessidade de definir uma forma de restrição adicional ao sistema diferente do sistema de forças.

Essas abordagens necessitam de analise para corpos não líquidos que interagirão com o sistema (pedra jogada dentro de um copo de água) pois é necessário definir como esse corpo propagará a informação para os elementos da simulação da existência de um corpo estranho em seu meio, a abordagem de forças é uma abordagem mais genérica, pois basta definir um elemento novo no ambiente o qual possui uma força de repulsão ao se aproximar das regiões definidas como limite espacial do corpo.

%\subsection{Comportamento das forças}


%\subsubsection{Atrito / Viscosidade}


\subsubsection{Estabilidade e entropia}
\label{sec:impl_reg_entropia}
O problema de instabilidade ocorre pela funcionamento básico do {\it steering behavior}, o mesmo não utiliza a energia existente no elemento na adição das forças de interação com a vizinhança, a força é criada fazendo com que o sistema não se estabilize. A criação de forças é uma característica intrínseca ao funcionamento do {\it steering behavior} fazendo com que a mesma não possa ser alterada ou removida, sendo necessário desenvolver uma metodologia baseada em forças para que essas a entropia do sistema se estabilize. Algumas regras foram definidas para que o sistema tendesse ao equilíbrio, essas regras são de perda e adição de energia ao sistema.
\begin{itemize}
\item Perda de energia pelo sistema. Como no mundo real o atrito e a interação das moléculas fazem com que o sistema tenda a se estabilizar, em nossa abordagem os elementos perdem sua velocidade quando próximos a outros elementos (caracterizando a viscosidade) e quando interagindo com a parede do recipiente (caracterizando o atrito com outros elementos
\item Adição de energia somente. A força somente será criada quando for necessária e guardando as proporções dos eventos.
\end{itemize}